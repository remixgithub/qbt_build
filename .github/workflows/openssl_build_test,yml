name: test
on: push
jobs:
  build:
    runs-on: windows-2019
    steps:
    - uses: ilammy/msvc-dev-cmd@v1
    - name: zlib
      run: |
        aria2c https://www.zlib.net/zlib-1.3.tar.gz
        tar xf zlib-1.3.tar.gz
        cd zlib-1.3
        nmake -f win32/Makefile.msc
        xcopy zconf.h C:\qbt\include\
        xcopy zlib.h C:\qbt\include\
        xcopy zlib.lib C:\qbt\lib\
    - name: openssl
      run: |
        aria2c https://www.nasm.us/pub/nasm/releasebuilds/2.16.01/win64/nasm-2.16.01-win64.zip
        7z x nasm-2.16.01-win64.zip
        xcopy nasm-2.16.01\nasm.exe C:\qbt\bin\
        aria2c https://download.qt.io/official_releases/jom/jom_1_1_4.zip
        7z x jom_1_1_4.zip
        xcopy jom.exe C:\qbt\bin\
        aria2c https://www.openssl.org/source/openssl-1.1.1w.tar.gz
        tar xf openssl-1.1.1w.tar.gz
        cd openssl-1.1.1w
        $env:PATH += ";C:\qbt\bin\"
        perl Configure VC-WIN64A no-shared no-tests no-apps --prefix=C:\qbt --with-zlib-include=C:\qbt\include --with-zlib-lib=C:\qbt\lib\zlib.lib /FS
        jom
        nmake install_sw
    - uses: actions/upload-artifact@v3
      with:
        name: openssl
        path: C:\qbt
